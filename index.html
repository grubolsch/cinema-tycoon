<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cinema tycoon</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="css/layout.css" type="text/css" rel="stylesheet" />

    <script src="Utils.js"></script>
    <script src="Manager/Observer.js"></script>

    <script src="Manager/ConfigManager.js"></script>
    <script src="Manager/FinanceManager.js"></script>
    <script src="Manager/TimeManager.js"></script>

    <script src="Entity/Cinema.js"></script>

    <script src="Render/Render.js"></script>
</head>
<body>

<table width="100%">
    <tr>
        <td id="ui-name"></td>
        <td id="ui-date"></td>
        <td id="ui-currentcredit"></td>
        <td id="ui-fans"></td>
        <td><button rel="openSettings" type="button" class="btn btn-primary top-menu">Settings</button></td>
        <td><button rel="research" class="btn btn-primary top-menu">Research</button></td>
        <td><button rel="schedule" class="btn btn-primary top-menu">Schedule</button></td>
        <td><button rel="advertising" class="btn btn-primary top-menu">Advertising</button></td>
        <td><button rel="loans" class="btn btn-primary top-menu">Loans</button></td>
        <td><button rel="tickets" class="btn btn-primary top-menu">Tickets</button></td>
        <td><button rel="statistics" class="btn btn-primary top-menu">Statistics</button></td>
        <td><button rel="customers" class="btn btn-primary top-menu">Customers</button></td>

        <td>
            <img src="assets/icons/pause-128.png" class="speed clickable" data-ticks="0" height="16"/>
            <img src="assets/icons/play-128.png" class="speed clickable" data-ticks="1" height="16"/>
            <img src="assets/icons/double-arrow-right-128.png" class="speed clickable" data-ticks="4" height="16"/>
            <img src="assets/icons/fast-forward-128.png" class="speed clickable" data-ticks="8" height="16"/>
        </td>
    </tr>
</table>

<script>
    var observer = new Observer;

    document.addEventListener('DOMContentLoaded', function() {
        // temporary code, this should come from a save or a "create new game" menu
        let cinema = new Cinema("Our own Cinema", new TimeManager(observer), ConfigManager);

        //Object responsible for rendering changes in state
        let render = new Render;

        //the main loop that makes the game has a flow of time
        setInterval(function () {
            for (var i = 0; render.speed > i; i++) {
                cinema.update();
            }
            render.render(cinema);
        }, 1000);

        // tmp example code to show the day changed
        observer.subscribe('day', function(params) {
            alert('Day is changed')
        });
        // end example code

        //control the speed buttons
        document.querySelectorAll('img.speed').forEach(function(element) {
            element.addEventListener('click', function () {
                console.log('changed speed');

                console.log(this)
                render.speed = this.dataset.ticks;
            });
        });
    });
</script>

</body>
</html>